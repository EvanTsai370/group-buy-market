# ===================================================================
# 公共配置 (Common)
# ===================================================================
spring:
  profiles:
    # 【关键】在这里切换环境：dev | prod | test
    active: dev

  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      adjust-dates-to-context-time-zone: false
  
  messages:
    basename: i18n/messages
    encoding: UTF-8

  # Redis 配置
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      password:  # 如果有密码就填写
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 8    # 连接池最大连接数
          max-idle: 8      # 连接池最大空闲连接数
          min-idle: 0      # 连接池最小空闲连接数
          max-wait: -1ms   # 连接池最大阻塞等待时间

  # RabbitMQ 配置 (TradeOrder超时处理)
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /
    listener:
      simple:
        acknowledge-mode: manual  # 手动确认消息
        prefetch: 1               # 每次只取1条消息
        retry:
          enabled: false          # 禁用自动重试（我们在代码中处理）

  # JWT 配置
  jwt:
    secret: myGroupBuyMarketSecretKeyForJwtTokenGenerationMustBe32BytesLong
    expiration: 86400000         # 24小时 (24 * 60 * 60 * 1000)
    refresh-expiration: 604800000 # 7天


# MyBatis Plus 全局通用配置
mybatis-plus:
  mapper-locations: classpath:/mybatis/mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# 应用自定义配置 (可以作为默认值)
app:
  thread-pool:
    core-size: 8
    max-size: 20
    queue-capacity: 200
    keep-alive-seconds: 60
    thread-name-prefix: "my-async-"

# 支付安全配置
payment:
  # 支付宝配置
  alipay:
    secret: ${ALIPAY_SECRET:your-alipay-secret-key-change-in-production}
  
  # 微信支付配置
  wechat:
    secret: ${WECHAT_SECRET:your-wechat-secret-key-change-in-production}
  
  # 银联支付配置
  unionpay:
    secret: ${UNIONPAY_SECRET:your-unionpay-secret-key-change-in-production}
  
  # IP 白名单（支付系统回调IP）
  # 生产环境请替换为真实的支付系统IP
  allowed-ips:
    - 127.0.0.1        # 本地测试
    - ::1              # 本地测试 IPv6
    # - 123.45.67.89   # 支付宝回调IP（示例，请替换为真实IP）
    # - 98.76.54.32    # 微信回调IP（示例，请替换为真实IP）

# 支付宝沙箱配置
alipay:
  # 沙箱环境网关
  gateway-url: https://openapi-sandbox.dl.alipaydev.com/gateway.do
  # 沙箱应用ID（请替换为您的沙箱AppID）
  app-id: ${ALIPAY_APP_ID:}
  # 商户PID
  seller-id: ${ALIPAY_SELLER_ID:}
  # 应用私钥（请替换为您的应用私钥）
  private-key: ${ALIPAY_PRIVATE_KEY:}
  # 支付宝公钥（请替换为您的支付宝公钥）
  alipay-public-key: ${ALIPAY_PUBLIC_KEY:}
  # 签名类型
  sign-type: RSA2
  charset: UTF-8
  # 同步跳转地址（浏览器直接访问，可以用 localhost）
  return-url: ${ALIPAY_RETURN_URL:}
  # 异步通知地址（支付宝服务器回调，必须是公网地址）
  # 开发环境：使用 natapp 等内网穿透工具提供的公网地址
  # 生产环境：使用真实的公网域名
  notify-url: ${ALIPAY_NOTIFY_URL:}

# 活动动态配置
activity:
  downgrade:
    switch: false  # 降级开关，默认关闭
  cut:
    range: 100     # 切量范围（0-100），100表示100%全量放行，10表示10%切量

# 文件上传配置
file:
  upload:
    # 文件存储路径（本地磁盘）
    # 开发环境示例：/Users/bin/upload
    # 生产环境示例：/var/www/upload
    path: ${FILE_UPLOAD_PATH:/tmp/my-group-buy-market/upload}
    # 文件访问URL前缀
    url-prefix: ${FILE_UPLOAD_URL_PREFIX:http://localhost:8080/files}
    # 允许的文件类型
    allowed-types: jpg,jpeg,png,gif,webp
    # 最大文件大小（5MB）
    max-size: 5242880